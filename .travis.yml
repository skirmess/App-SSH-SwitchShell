# Automatically generated file
# Dist::Zilla::Plugin::Author::SKIRMESS::RepositoryBase 0.032

language: perl

cache:
  directories:
    - ~/perl5

env:
  global:
    - AUTOMATED_TESTING=1

matrix:
  include:
    - perl: '5.8'

    - perl: '5.10'
      env: AUTHOR_TESTING=1

    - perl: '5.12'
      env: AUTHOR_TESTING=1

    - perl: '5.14'
      env: AUTHOR_TESTING=1

    - perl: '5.16'
      env: AUTHOR_TESTING=1

    - perl: '5.18'
      env: AUTHOR_TESTING=1

    - perl: '5.18'
      env: AUTHOR_TESTING=1
      os: osx

    - perl: '5.20'
      env: AUTHOR_TESTING=1

    - perl: '5.22'
      env: AUTHOR_TESTING=1

    - perl: '5.24'
      env: AUTHOR_TESTING=1

    - perl: '5.26'
      env: AUTHOR_TESTING=1

before_install:
  - |
    case "${TRAVIS_OS_NAME}" in
      "linux" )
        ;;
      "osx"   )
        # TravisCI extracts the broken perl archive with sudo which creates the
        # $HOME/perl5 directory with owner root:staff. Subdirectories under
        # perl5 are owned by user travis.
        sudo chown "$USER" "$HOME/perl5"

        # The perl distribution TravisCI extracts on OSX is incomplete
        sudo rm -rf "$HOME/perl5/perlbrew"

        # Install cpanm and local::lib
        curl -L https://cpanmin.us | perl - App::cpanminus local::lib
        eval $(perl -I $HOME/perl5/lib/perl5/ -Mlocal::lib)
        ;;
    esac

install:
  - |
    if [ -n "$AUTHOR_TESTING" ]
    then
      cpanm --quiet --installdeps --notest --skip-satisfied --with-develop .
    else
      cpanm --quiet --installdeps --notest --skip-satisfied .
    fi

script:
  - perl Makefile.PL && make test
  - |
    if [ -n "$AUTHOR_TESTING" ]
    then
      prove -lr xt/author
    fi
